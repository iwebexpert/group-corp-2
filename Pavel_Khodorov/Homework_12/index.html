
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
</head>
<body>
    <script>
        class Ingredient {
            constructor(id, category, name, price, kkal) {
                this.id = id; // Идентификатор
                this.category = category; // 0- размер, 1 - начинка, 2 - внешняя добавка
                this.name = name; // Название
                this.price = price; // Цена
                this.kkal = kkal; // Калорийность
            }
        }
 
        // Признаки богатой доменной модели:
        // Храним не фактические данные, а ссылки на объекты.
        class Gamburger {
            constructor(gamburgerSize = null, insideIngredient = null) {
                this.gamburgerSize = gamburgerSize;
                this.insideIngredient = insideIngredient;
                this.outerIngredients = new Set();
            }
 
            get isReady() {
                return this.gamburgerSize != null && this.insideIngredient != null;
            }
 
            get moneySum() {
                if (!this.isReady)
                    throw new Error("Is not ready.");
 
                let sum = this.gamburgerSize.price;
                sum += this.insideIngredient.price;
                for (let item of this.outerIngredients) {
                    sum += item.price;
                }
                return sum;
            }
 
            get kkalSum() {
                if (!this.isReady)
                    throw new Error("Is not ready.");
 
                let sum = this.gamburgerSize.kkal;
                sum += this.insideIngredient.kkal;
                for (let item of this.outerIngredients) {
                    sum += item.kkal;
                }
                return sum;
 
            }
 
            get name() {
                if (!this.isReady)
                    throw new Error("Is not ready.");
 
                let name = this.gamburgerSize.name + " (";
                name += this.insideIngredient.name;
                for (let item of this.outerIngredients) {
                    name += ", " + item.name;
                }
                return name + ")";
            }
 
            // Вызов строителя можно не включать в общий интерфейс объекта
            static get builder() { return new GamburgerBuilder(); }
        }
 
        class GamburgerBuilder {
            get isReady() { return this.gamburger.isReady; };
 
            constructor() {
                this.gamburger = new Gamburger();
            }
 
            withInside(ingredient) {
                if (!ingredient || ingredient.category != 1) // Guard на несовместимость ингредиента.
                    throw new Error("WithInside");
 
                this.gamburger.insideIngredient = ingredient;
                return this;
            }
 
            withSize(ingredient) {
                if (!ingredient || ingredient.category != 0) // Guard на несовместимость ингредиента.
                    throw new Error("WithSize");
 
                this.gamburger.gamburgerSize = ingredient;
                return this;
            }
 
            build() {
                if (!this.isReady)
                    throw new Error("Is not ready.");
 
                return this.gamburger;
            }
        }
 
        // Базовый класс Декоратор для гамбургера
        class GamburgerDecorator {
            constructor(gamburger) {
                this.gamburger = gamburger;
            }
 
            get gamburgerSize() { return this.gamburger.gamburgerSize; }
            set gamburgerSize(value) { gamburger.gamburgerSize = value; }
 
            get insideIngredient() { return this.gamburger.insideIngredient; }
            set insideIngredient(value) { this.gamburger.insideIngredient = value; }
 
            get outerIngredients() { return this.gamburger.outerIngredients; }
 
            get moneySum() { return this.gamburger.moneySum; }
 
            get kkalSum() { return this.gamburger.kkalSum; }
 
            get name() { return this.gamburger.name; }
        }
 
        class SpeciesGamburger extends GamburgerDecorator {
            constructor(gamburger) {
                super(gamburger);
                this.gamburger.outerIngredients.add(ingredients[5]);
            }
        }
 
        class MaionezGamburger extends GamburgerDecorator {
            constructor(gamburger) {
                super(gamburger);
                this.gamburger.outerIngredients.add(ingredients[6]);
            }
        }
 
        let ingredients = [
            new Ingredient(1, 0, "Маленький гамбургер", 50, 20),
            new Ingredient(2, 0, "Большой гамбургер", 100, 40),
            new Ingredient(3, 1, "сыр", 10, 20),
            new Ingredient(4, 1, "салат", 20, 5),
            new Ingredient(5, 1, "картофель", 15, 10),
            new Ingredient(6, 2, "приправа", 15, 0),
            new Ingredient(7, 2, "майонез", 20, 5),
        ];
 
        let burger = new MaionezGamburger(new MaionezGamburger(new SpeciesGamburger(
            Gamburger.builder
                .withInside(ingredients[3]) // с салатом
                .withSize(ingredients[0]) // Маленький гамбургер
                .build()
        )));
 
        console.log(burger);
    </script>
</body>
</html>